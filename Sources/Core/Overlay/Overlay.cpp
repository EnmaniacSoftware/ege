#include "Core/Overlay/Overlay.h"

EGE_NAMESPACE_BEGIN

//--------------------------------------------------------------------------------------------------------------------------------------------------------------
EGE_DEFINE_NEW_OPERATORS(Overlay)
EGE_DEFINE_DELETE_OPERATORS(Overlay)
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
Overlay::Overlay(Engine& engine, const String& name, egeObjectDeleteFunc deleteFunc) : Object(EGE_OBJECT_UID_OVERLAY, deleteFunc)
                                                                                     , m_engine(engine) 
                                                                                     , m_name(name) 
                                                                                     , m_updateNeeded(false) 
                                                                                     , m_visible(true)
                                                                                     , m_size(Vector2f::ZERO)
{
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
Overlay::Overlay(Engine& engine, const String& name, u32 uid, egeObjectDeleteFunc deleteFunc) : Object(uid, deleteFunc)
                                                                                              , m_engine(engine) 
                                                                                              , m_name(name)
                                                                                              , m_updateNeeded(false) 
                                                                                              , m_visible(true)
                                                                                              , m_size(Vector2f::ZERO)
{
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
Overlay::~Overlay()
{
  m_physics     = NULL;
  m_renderData  = NULL;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
bool Overlay::isValid() const
{
  return (NULL != m_physics) && (NULL != m_renderData);
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::update(const Time& time)
{
  EGE_UNUSED(time);
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::initialize()
{
  m_physics = ege_new PhysicsComponent(engine(), "overlay_" + name());
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::invalidate()
{
  m_updateNeeded = true;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::validate()
{
  m_updateNeeded = false;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::setVisible(bool set)
{
  if (m_visible != set)
  {
    m_visible = set;

    if (m_visible)
    {
      invalidate();
    }
  }
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::setAlignment(Alignment align)
{
  if (m_alignment != align)
  {
    m_alignment = align;
    invalidate();
  }
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::setAlpha(float32 alpha)
{
  if (m_renderData->material())
  {
    m_renderData->material()->setDiffuseAlpha(alpha);
  }
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
const Vector2f& Overlay::size() const
{
  return m_size;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
void Overlay::setSize(const Vector2f& size)
{
  if (m_size != size)
  {
    m_size = size;
    invalidate();
  }
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------
Engine& Overlay::engine() const
{
  return m_engine;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------

EGE_NAMESPACE_END
